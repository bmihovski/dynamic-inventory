#!/bin/bash

OUTPUT_INVENTORY="generated_hosts"

if [[ -z "${PLAYBOOK}" ]]; then
  echo
  echo "PLAYBOOK must be provided."
  exec /usr/local/bin/usage
fi

# generate inventory script
/usr/local/bin/generate ${OUTPUT_INVENTORY}

# run ansible playbook using generated inventory
ansible-playbook -vvv -i ${OUTPUT_INVENTORY} ${PLAYBOOK}  --become --become-user root